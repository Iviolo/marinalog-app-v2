<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MarinaLog - Gestione Personale</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%); min-height: 100vh; padding: 10px; }
        .container { max-width: 1000px; margin: 0 auto; background: rgba(255,255,255,0.97); border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px 20px; text-align: center; }
        .header h1 { font-size: 32px; margin-bottom: 10px; }
        .tabs-container { display: flex; gap: 5px; padding: 15px 10px; background: #f5f5f5; overflow-x: auto; flex-wrap: wrap; }
        .tab-btn { padding: 10px 16px; border: 2px solid transparent; background: white; color: #667eea; border-radius: 10px; cursor: pointer; font-weight: bold; transition: all 0.3s; }
        .tab-btn.active { background: #667eea; color: white; box-shadow: 0 4px 15px rgba(102,126,234,0.4); }
        .content { padding: 20px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-bottom: 20px; }
        .stat-card { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 15px; text-align: center; box-shadow: 0 8px 20px rgba(102,126,234,0.3); transition: all 0.3s; }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-card.pink { background: linear-gradient(135deg, #f093fb, #f5576c); }
        .stat-card.cyan { background: linear-gradient(135deg, #4facfe, #00f2fe); }
        .stat-card.green { background: linear-gradient(135deg, #43e97b, #38f9d7); }
        .stat-value { font-size: 28px; font-weight: bold; }
        .form-group { margin: 15px 0; }
        .form-group label { display: block; font-weight: bold; margin-bottom: 6px; color: #333; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; }
        .btn-submit { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 12px 24px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; width: 100%; font-size: 16px; transition: all 0.3s; }
        .btn-reset { background: linear-gradient(135deg, #f5576c, #f093fb); color: white; padding: 10px 20px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: all 0.3s; }
        .entry-item { background: #f9f9f9; padding: 12px; border-radius: 10px; margin-bottom: 8px; border-left: 4px solid #667eea; display: flex; justify-content: space-between; align-items: center; }
        .btn-delete { background: #f5576c; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; }
        .chat-box { background: #f5f5f5; border: 2px solid #ddd; border-radius: 10px; padding: 12px; height: 350px; overflow-y: auto; margin-bottom: 12px; }
        .chat-message { margin: 8px 0; padding: 10px; border-radius: 8px; font-size: 13px; }
        .chat-message.user { background: #667eea; color: white; margin-left: 15%; text-align: right; }
        .chat-message.bot { background: #e3f2fd; color: #333; margin-right: 15%; }
        .chat-input-group { display: flex; gap: 8px; }
        .chat-input-group input { flex: 1; padding: 10px; border: 2px solid #ddd; border-radius: 8px; }
        .chat-input-group button { padding: 10px 16px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; }
        h2 { color: #333; margin-bottom: 15px; font-size: 20px; }
        h3 { color: #555; margin: 15px 0 10px 0; font-size: 16px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚öì MARINALOG</h1>
            <p>Gestione Personale - Ferie, Reperibilit√†, Guardie e Recupero</p>
        </div>
        <div class="tabs-container">
            <button class="tab-btn active" onclick="switchTab('dashboard')">üìä Dashboard</button>
            <button class="tab-btn" onclick="switchTab('add')">‚ûï Aggiungi</button>
            <button class="tab-btn" onclick="switchTab('history')">üìã Cronologia</button>
            <button class="tab-btn" onclick="switchTab('assistant')">ü§ñ IA</button>
        </div>
        <div class="content">
            <div id="dashboard" class="tab-content active">
                <h2>üìä Statistiche</h2>
                <div class="stats-grid">
                    <div class="stat-card"><div style="font-size:12px">Ferie</div><div class="stat-value" id="ferie-val">0/39</div></div>
                    <div class="stat-card pink"><div style="font-size:12px">Malattia</div><div class="stat-value" id="malattia-val">0/4</div></div>
                    <div class="stat-card cyan"><div style="font-size:12px">Reperibilit√†</div><div class="stat-value" id="reperibilita-val">0h</div></div>
                    <div class="stat-card green"><div style="font-size:12px">Guardie</div><div class="stat-value" id="guardia-val">0h</div></div>
                    <div class="stat-card" style="background:linear-gradient(135deg,#fa709a,#fee140)"><div style="font-size:12px">Recupero</div><div class="stat-value" id="recupero-val">0h</div></div>
                    <div class="stat-card" style="background:linear-gradient(135deg,#30cfd0,#330867)"><div style="font-size:12px">Compensi</div><div class="stat-value" id="compensi-val">‚Ç¨0</div></div>
                </div>
                <h3>üìù Ultime Registrazioni</h3>
                <div id="latest-entries"></div>
                <div style="text-align:center;margin-top:20px;padding-top:15px;border-top:2px solid #ddd">
                    <button class="btn-reset" onclick="resetAllData()">üîÑ Resetta Tutto</button>
                </div>
            </div>
            <div id="add" class="tab-content">
                <h2>‚ûï Aggiungi Registrazione</h2>
                <form onsubmit="addEntry(event)">
                    <div class="form-group"><label>üìÖ Data:</label><input type="date" id="entry-date" required></div>
                    <div class="form-group"><label>üìå Tipo:</label><select id="entry-type" required><option>Ferie Ordinarie</option><option>Malattia</option><option>Reperibilit√†</option><option>Guardia</option><option>Recupero</option></select></div>
                    <div class="form-group"><label>‚è±Ô∏è Ore:</label><input type="number" id="entry-hours" placeholder="es. 8" min="0" step="0.5"></div>
                    <div class="form-group"><label>üí¨ Note:</label><textarea id="entry-notes" placeholder="Aggiungi note..." rows="4"></textarea></div>
                    <button type="submit" class="btn-submit">‚úì Registra</button>
                </form>
            </div>
            <div id="history" class="tab-content">
                <h2>üìã Cronologia Completa</h2>
                <div id="history-entries"></div>
            </div>
            <div id="assistant" class="tab-content">
                <h2>ü§ñ Assistente IA (Gemini)</h2>
                <div class="chat-box" id="chat-box"></div>
                <div class="chat-input-group">
                    <input type="text" id="chat-input" placeholder="Chiedi qualsiasi cosa...">
                    <button type="button" onclick="sendMessage()">Invia</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        const GEMINI_API_KEY = 'AIzaSyBNCf0dmzdrk3UjQzif6JWaV7jAhle-GM';
        let entries = JSON.parse(localStorage.getItem('marinalog_entries')) || [];

        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tab).classList.add('active');
            event.target.classList.add('active');
        }

        function addEntry(e) {
            e.preventDefault();
            const entry = {
                date: document.getElementById('entry-date').value,
                type: document.getElementById('entry-type').value,
                hours: parseFloat(document.getElementById('entry-hours').value) || 0,
                notes: document.getElementById('entry-notes').value
            };
            entries.push(entry);
            localStorage.setItem('marinalog_entries', JSON.stringify(entries));
            updateStats();
            alert('‚úì Registrazione aggiunta!');
            document.getElementById('entry-date').value = '';
            document.getElementById('entry-hours').value = '';
            document.getElementById('entry-notes').value = '';
        }

        function updateStats() {
            let ferie = entries.filter(e => e.type === 'Ferie Ordinarie').length;
            let malattia = entries.filter(e => e.type === 'Malattia').length;
            let reperibilita = entries.filter(e => e.type === 'Reperibilit√†').reduce((s,e) => s+e.hours, 0);
            let guardia = entries.filter(e => e.type === 'Guardia').reduce((s,e) => s+e.hours, 0);
            let recupero = entries.filter(e => e.type === 'Recupero').reduce((s,e) => s+e.hours, 0);
            let compensi = (reperibilita * 30) + (guardia * 90);
            
            document.getElementById('ferie-val').textContent = ferie + '/39';
            document.getElementById('malattia-val').textContent = malattia + '/4';
            document.getElementById('reperibilita-val').textContent = reperibilita.toFixed(1) + 'h';
            document.getElementById('guardia-val').textContent = guardia.toFixed(1) + 'h';
            document.getElementById('recupero-val').textContent = recupero.toFixed(1) + 'h';
            document.getElementById('compensi-val').textContent = '‚Ç¨' + compensi.toFixed(2);
            renderLatest();
            renderHistory();
        }

        function renderLatest() {
            let html = '';
            entries.slice(-5).reverse().forEach((e,i) => {
                html += `<div class="entry-item"><div class="entry-info"><strong>${e.date}</strong> - ${e.type} ${e.hours ? '(' + e.hours + 'h)' : ''}</div><button type="button" class="btn-delete" onclick="deleteEntry(${entries.length-1-i})">‚ùå</button></div>`;
            });
            document.getElementById('latest-entries').innerHTML = html || '<div style="text-align:center;color:#999;padding:20px">Nessuna registrazione</div>';
        }

        function renderHistory() {
            let html = '';
            entries.forEach((e,i) => {
                html += `<div class="entry-item"><div class="entry-info"><strong>${e.date}</strong> - ${e.type} ${e.hours ? '(' + e.hours + 'h)' : ''}</div><button type="button" class="btn-delete" onclick="deleteEntry(${i})">‚ùå</button></div>`;
            });
            document.getElementById('history-entries').innerHTML = html || '<div style="text-align:center;color:#999;padding:20px">Nessuna registrazione</div>';
        }

        function deleteEntry(idx) {
            if(confirm('Elimina?')) {
                entries.splice(idx, 1);
                localStorage.setItem('marinalog_entries', JSON.stringify(entries));
                updateStats();
            }
        }

        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const msg = input.value.trim();
            if(!msg) return;
            
            const chatBox = document.getElementById('chat-box');
            const userMsg = document.createElement('div');
            userMsg.className = 'chat-message user';
            userMsg.textContent = msg;
            chatBox.

